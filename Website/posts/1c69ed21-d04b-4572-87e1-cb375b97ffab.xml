<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>UDF - Compare two comma seperated lists</title>
  <slug>udf-compare-two-comma-seperated-lists</slug>
  <author>Chris Hynes</author>
  <pubDate>2007-02-05 19:19:00</pubDate>
  <lastModified>2014-11-20 17:18:41</lastModified>
  <content>&lt;p&gt;I recently had a friend ask for help comparing two comma seperated lists in SQL server using a UDF. I started based around the Split UDF I wrote, and continued from there. The simplest and most performant thing I could think of was to use an INNER JOIN to compare the table values of the two lists. Then just compare the counts you get back to make sure they're all the same. Here's the UDF:&lt;/p&gt;
&lt;blockquote&gt;&lt;code&gt;&lt;font color="#0000ff" size="2"&gt;
&lt;p&gt;SET&lt;/p&gt;&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;ANSI_NULLS&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;ON&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;GO&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;SET&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;QUOTED_IDENTIFIER&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;ON&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;GO&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;
&lt;p&gt;CREATE&lt;/p&gt;&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;FUNCTION&lt;/font&gt;&lt;font size="2"&gt; IsCommaListMatch&lt;br /&gt;&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;   @list1 &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;varchar&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;255&lt;/font&gt;&lt;font color="#808080" size="2"&gt;),&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;   @list2 &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;varchar&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;255&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;br /&gt;)&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;RETURNS&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;bit&lt;br /&gt;AS&lt;br /&gt;BEGIN&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @isMatch &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;bit&lt;/font&gt;&lt;font size="2"&gt;
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @list1Values &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;TABLE&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;val &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @list2Values &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;TABLE&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;val &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;/font&gt;&lt;font size="2"&gt;
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   INSERT&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;INTO&lt;/font&gt;&lt;font size="2"&gt; @list1Values &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;SELECT&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#808080" size="2"&gt;*&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;FROM&lt;/font&gt;&lt;font size="2"&gt; dbo&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;Split&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;@list1&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   INSERT&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;INTO&lt;/font&gt;&lt;font size="2"&gt; @list2Values &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;SELECT&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#808080" size="2"&gt;*&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;FROM&lt;/font&gt;&lt;font size="2"&gt; dbo&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;Split&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;@list2&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;/font&gt;&lt;font size="2"&gt;
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @count1 &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @count2 &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @count1Join &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   DECLARE&lt;/font&gt;&lt;font size="2"&gt; @count2Join &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;int&lt;/font&gt;&lt;font size="2"&gt;
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   SELECT&lt;/font&gt;&lt;font size="2"&gt; @count1&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font color="#ff00ff" size="2"&gt;COUNT&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;val&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;FROM&lt;/font&gt;&lt;font size="2"&gt; @list1Values&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   SELECT&lt;/font&gt;&lt;font size="2"&gt; @count2&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font color="#ff00ff" size="2"&gt;COUNT&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;val&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;FROM&lt;/font&gt;&lt;font size="2"&gt; @list2Values
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   SELECT&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;      @count1Join&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font color="#ff00ff" size="2"&gt;COUNT&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;list1Values&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;val&lt;/font&gt;&lt;font color="#808080" size="2"&gt;),&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;      @count2Join&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font color="#ff00ff" size="2"&gt;COUNT&lt;/font&gt;&lt;font color="#808080" size="2"&gt;(&lt;/font&gt;&lt;font size="2"&gt;list2Values&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;val&lt;/font&gt;&lt;font color="#808080" size="2"&gt;)&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   FROM&lt;br /&gt;      &lt;/font&gt;&lt;font size="2"&gt;@list1Values list1Values&lt;br /&gt;&lt;/font&gt;&lt;font color="#808080" size="2"&gt;         INNER&lt;/font&gt;&lt;font size="2"&gt; &lt;/font&gt;&lt;font color="#808080" size="2"&gt;JOIN&lt;/font&gt;&lt;font size="2"&gt; @list2Values list2Values&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;            ON&lt;br /&gt;&lt;/font&gt;&lt;font size="2"&gt;               list1Values&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;val&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;list2Values&lt;/font&gt;&lt;font color="#808080" size="2"&gt;.&lt;/font&gt;&lt;font size="2"&gt;val
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   IF&lt;/font&gt;&lt;font size="2"&gt; @count1&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;@count2 &lt;/font&gt;&lt;font color="#808080" size="2"&gt;AND&lt;/font&gt;&lt;font size="2"&gt; @count1&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;@count1Join &lt;/font&gt;&lt;font color="#808080" size="2"&gt;AND&lt;/font&gt;&lt;font size="2"&gt; @count2&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;@count2Join&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;      SET&lt;/font&gt;&lt;font size="2"&gt; @isMatch&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;1&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   ELSE&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;      SET&lt;/font&gt;&lt;font size="2"&gt; @isMatch&lt;/font&gt;&lt;font color="#808080" size="2"&gt;=&lt;/font&gt;&lt;font size="2"&gt;0
&lt;p /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;   RETURN&lt;/font&gt;&lt;font size="2"&gt; @isMatch&lt;br /&gt;&lt;/font&gt;&lt;font color="#0000ff" size="2"&gt;END&lt;/font&gt;&lt;font size="2"&gt;
&lt;p&gt;GO&lt;/p&gt;&lt;/font&gt;&lt;/code&gt;&lt;/blockquote&gt;
&lt;p&gt;As always, feel free to contact me if you have ideas on improving this.&lt;/p&gt;</content>
  <ispublished>true</ispublished>
  <categories>
    <category>SQL</category>
  </categories>
  <comments></comments>
</post>